// Generated by purs version 0.11.6
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Eff_Exception = require("../Control.Monad.Eff.Exception");
var Control_Monad_Error_Class = require("../Control.Monad.Error.Class");
var Control_Monad_Except = require("../Control.Monad.Except");
var Control_Monad_Free = require("../Control.Monad.Free");
var Data_Either = require("../Data.Either");
var Data_Foreign = require("../Data.Foreign");
var Data_Foreign_Class = require("../Data.Foreign.Class");
var Data_Function = require("../Data.Function");
var Data_List_Types = require("../Data.List.Types");
var Data_NaturalTransformation = require("../Data.NaturalTransformation");
var Data_Semigroup = require("../Data.Semigroup");
var Data_Show = require("../Data.Show");
var Prelude = require("../Prelude");
var Presto_Core_Types_API = require("../Presto.Core.Types.API");
var Presto_Core_Types_Language_Interaction = require("../Presto.Core.Types.Language.Interaction");
var interpretAPI = function (apiRunner) {
    return function (v) {
        var v1 = Control_Monad_Except.runExcept(Data_Foreign_Class.decode(Presto_Core_Types_API.decodeRequestG)(v.value0));
        if (v1 instanceof Data_Either.Left) {
            return Control_Monad_Error_Class.throwError(Control_Monad_Aff.monadThrowAff)(Control_Monad_Eff_Exception.error("apiInteract is broken: " + Data_Show.show(Data_List_Types.showNonEmptyList(Data_Foreign.showForeignError))(v1.value0)));
        };
        if (v1 instanceof Data_Either.Right) {
            return Control_Bind.bind(Control_Monad_Aff.bindAff)(apiRunner(v1.value0))(function (v2) {
                return Control_Applicative.pure(Control_Monad_Aff.applicativeAff)(v.value1(Presto_Core_Types_Language_Interaction.ForeignOut(Data_Foreign_Class.encode(Data_Foreign_Class.stringEncode)(v2))));
            });
        };
        throw new Error("Failed pattern match at Presto.Core.Language.Runtime.API line 22, column 3 - line 27, column 45: " + [ v1.constructor.name ]);
    };
};
var runAPIInteraction = function (apiRunner) {
    return Control_Monad_Free.foldFree(Control_Monad_Aff.monadRecAff)(interpretAPI(apiRunner));
};
module.exports = {
    runAPIInteraction: runAPIInteraction
};
