// Generated by purs version 0.11.6
"use strict";
var Control_Applicative = require("../Control.Applicative");
var Control_Apply = require("../Control.Apply");
var Control_Bind = require("../Control.Bind");
var Control_Monad_Aff = require("../Control.Monad.Aff");
var Control_Monad_Aff_AVar = require("../Control.Monad.Aff.AVar");
var Control_Monad_Eff = require("../Control.Monad.Eff");
var Control_Monad_Except_Trans = require("../Control.Monad.Except.Trans");
var Control_Monad_Free = require("../Control.Monad.Free");
var Control_Monad_State_Trans = require("../Control.Monad.State.Trans");
var Data_Either = require("../Data.Either");
var Data_Function = require("../Data.Function");
var Data_Function_Uncurried = require("../Data.Function.Uncurried");
var Data_StrMap = require("../Data.StrMap");
var Data_Unit = require("../Data.Unit");
var Engineering_Helpers_Commons = require("../Engineering.Helpers.Commons");
var Engineering_OS_Permission = require("../Engineering.OS.Permission");
var Engineering_Types_App = require("../Engineering.Types.App");
var Prelude = require("../Prelude");
var Presto_Core_Flow = require("../Presto.Core.Flow");
var Presto_Core_Language_Runtime_Interpreter = require("../Presto.Core.Language.Runtime.Interpreter");
var Presto_Core_Types_Language_Flow = require("../Presto.Core.Types.Language.Flow");
var Product_Flow = require("../Product.Flow");
var UI_Types = require("../UI.Types");
var mainFlow = Control_Bind.bind(Control_Monad_Free.freeBind)(Control_Monad_Except_Trans.runExceptT(Product_Flow.screenFlow))(function (v) {
    if (v instanceof Data_Either.Right) {
        return Control_Applicative.pure(Control_Monad_Free.freeApplicative)(Data_Unit.unit);
    };
    if (v instanceof Data_Either.Left) {
        return mainFlow;
    };
    throw new Error("Failed pattern match at Core line 44, column 3 - line 46, column 23: " + [ v.constructor.name ]);
});
var initializeUI = Control_Apply.applySecond(Control_Monad_Free.freeApply)(Presto_Core_Types_Language_Flow.forkUI(UI_Types.initScreenInteract)(UI_Types.InitScreen.value))(Control_Applicative.pure(Control_Monad_Free.freeApplicative)(Data_Unit.unit));
var appFlow = Control_Bind.discard(Control_Bind.discardUnit)(Control_Monad_Free.freeBind)(initializeUI)(function () {
    return mainFlow;
});
var main = (function () {
    var uiRunner = function (a) {
        return Control_Monad_Aff.makeAff(function (err) {
            return function (sc) {
                return Engineering_Helpers_Commons["showUI'"](sc, a);
            };
        });
    };
    var permissionRunner = new Presto_Core_Language_Runtime_Interpreter.PermissionRunner(Engineering_OS_Permission.checkIfPermissionsGranted, Engineering_OS_Permission.requestPermissions);
    var apiRunner = function (request) {
        return Control_Monad_Aff.makeAff(function (err) {
            return function (sc) {
                return Engineering_Helpers_Commons["callAPI'"](err)(sc)(Engineering_Helpers_Commons.mkNativeRequest(request));
            };
        });
    };
    var runtime = new Presto_Core_Language_Runtime_Interpreter.Runtime(uiRunner, permissionRunner, apiRunner);
    var freeFlow = Control_Monad_State_Trans.evalStateT(Control_Monad_Aff.functorAff)(Presto_Core_Language_Runtime_Interpreter.run(runtime)(appFlow));
    return Control_Monad_Aff.launchAff(Control_Bind.bind(Control_Monad_Aff.bindAff)(Control_Monad_Aff_AVar["makeVar'"](Data_StrMap.empty))(freeFlow));
})();
module.exports = {
    appFlow: appFlow, 
    initializeUI: initializeUI, 
    main: main, 
    mainFlow: mainFlow
};
